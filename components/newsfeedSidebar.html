
<!-- ðŸ”¹ Activity Sidebar -->
<div id="activitySidebar" class="fixed top-0 right-0 w-full max-w-md h-full bg-black border-l border-yellow-500 z-50 transform translate-x-full transition-transform duration-300 flex flex-col">
  <!-- Close button is provided inside the sticky header below -->

  <!-- ðŸ”’ Locked Activity Modal -->
  <div id="lockedActivityModal" class="absolute bottom-10 left-0 right-0 z-50 bg-black border-t border-yellow-500 p-6 text-yellow-400 hidden">
    <div class="text-center">
      <button id="activitySignInBtn" type="button" class="block w-full bg-yellow-500 text-white py-3 rounded-full text-center font-semibold hover:bg-yellow-600">
        ðŸ”’ SIGN IN 
      </button>
    </div>
  </div>

<!-- ðŸ”¸ Sticky Header -->
<div class="sticky top-0 z-30 bg-black/90 backdrop-blur-sm border-b border-yellow-500 px-4 py-3">
  <div class="flex items-start justify-between gap-3 relative">
    <div class="space-y-1.5 pr-14">
      <h2 class="text-lg font-semibold text-yellow-400">ðŸŒ¹ Activity</h2>
      <div class="flex items-center gap-2">
        <button id="activityCommunityLabel" class="inline-flex items-center gap-2 rounded-full border border-yellow-500/40 bg-black/60 px-3 py-1 text-[11px] uppercase tracking-[0.25em] text-yellow-200 hover:bg-yellow-500 hover:text-black transition">
          <span>Community: Not selected</span>
        </button>
      </div>
      <div id="activityCommunityMeta" class="flex flex-wrap items-center gap-2 text-[11px] text-yellow-300/90">
        <!-- Chips injected by JS: members â€¢ county â€¢ MP -->
      </div>
      <!-- Activity category chips moved below community meta -->
      <div class="flex items-center justify-between gap-2 pt-1">
        <div id="activityCategoryButtons" class="flex items-center gap-2">
          <button class="activityCategoryBtn text-[10px] sm:text-[11px] font-semibold px-2.5 py-1 rounded-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black active:scale-95 transition-all bg-black/40 active-category" data-cat="general">General</button>
          <button class="activityCategoryBtn text-[10px] sm:text-[11px] font-semibold px-2.5 py-1 rounded-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black active:scale-95 transition-all bg-black/40" data-cat="announcements">Announcements</button>
          <button class="activityCategoryBtn text-[10px] sm:text-[11px] font-semibold px-2.5 py-1 rounded-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black active:scale-95 transition-all bg-black/40" data-cat="news">News</button>
        </div>
        <div class="flex items-center gap-2">
          <span id="activityCategoryLoading" class="hidden" aria-live="polite">
            <svg class="animate-spin h-4 w-4 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
          </span>
          <button id="activityLeaderboardBtn" title="Leaderboard" class="inline-flex items-center gap-1 text-[10px] sm:text-[11px] font-semibold px-2.5 py-1 rounded-full border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black transition">
            <i data-lucide="trophy" class="w-3.5 h-3.5"></i>
            <span class="hidden sm:inline">Leaderboard</span>
          </button>
        </div>
      </div>
    </div>
    <div class="flex items-center gap-3 pr-1 relative">
      <button id="activityInfoBtn" type="button" class="help-badge w-8 h-8 rounded-full border border-yellow-500/50 bg-black/80 text-yellow-300 hover:bg-yellow-500 hover:text-black flex items-center justify-center text-[12px] shrink-0 z-50 shadow-md">?</button>
      <!-- Force the close button to always be visible on mobile -->
      <button onclick="document.getElementById('activitySidebar').classList.add('translate-x-full')" class="absolute right-0 top-0 text-yellow-500 z-50 text-2xl font-bold leading-none px-1">Ã—</button>
    </div>
  </div>
</div>


  <!-- ðŸ”¸ Scrollable Post Content -->
  <div id="activityContent" class="relative flex-1 overflow-y-auto pt-20 px-4 pb-32 text-yellow-300 space-y-4">
   <!-- ðŸ”¸ Leaderboard Panel (hidden by default) -->
   <section id="activityLeaderboardPanel" class="hidden border border-yellow-500/40 bg-black/70 rounded-2xl p-4 text-sm text-yellow-200 space-y-2">
     <div class="flex items-center justify-between">
       <h3 class="text-base font-semibold text-yellow-100">Leaderboard</h3>
       <button id="closeLeaderboard" type="button" class="inline-flex items-center justify-center w-7 h-7 rounded-full border border-yellow-500/40 text-yellow-400 hover:bg-yellow-500 hover:text-black">Ã—</button>
     </div>
     <div id="leaderboardList" class="space-y-1 text-yellow-200 text-sm"></div>
   </section>
   <!-- Centered overlay spinner shown when switching categories -->
   <!-- Leave room for the bottom post form (do not cover it) -->
   <div id="activitySwitchSpinner" class="hidden absolute inset-x-0 top-0 bottom-24 z-40 bg-black/30 backdrop-blur-[1px] flex items-center justify-center pointer-events-none">
     <div class="flex flex-col items-center gap-2 text-yellow-300">
       <svg class="animate-spin h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
         <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
         <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
       </svg>
       <span class="text-sm">Loadingâ€¦</span>
     </div>
   </div>
   <div id="activityInfoCard" class="hidden rounded-2xl border border-yellow-500/40 bg-black/70 p-3 text-sm text-yellow-200 shadow">
     <span class="font-semibold text-yellow-300">Community Hub</span> â€” Post and share announcements + news in your local area. More features coming.
   </div>
   <section id="activityCommunityCard" class="hidden border border-yellow-500/40 bg-black/70 rounded-2xl p-4 text-sm text-yellow-200 space-y-3">
     <div class="flex items-center justify-between gap-2">
       <div>
         <p class="text-[10px] uppercase tracking-[0.3em] text-yellow-500/70">Community</p>
         <h3 class="text-base font-semibold text-yellow-100">Choose Your Local Hub</h3>
       </div>
       <div class="flex items-center gap-2">
         <button id="activityCommunityInfo" type="button" class="text-xs text-yellow-400 hover:text-yellow-200">Why?</button>
         <button id="communityCardClose" type="button" class="inline-flex items-center justify-center w-7 h-7 rounded-full border border-yellow-500/40 text-yellow-400 hover:bg-yellow-500 hover:text-black" aria-label="Close community picker">Ã—</button>
       </div>
     </div>
     <div class="relative">
       <input id="communitySearch" type="text" placeholder="Search a village, town or cityâ€¦" class="w-full rounded-xl border border-yellow-500/30 bg-black/80 px-3 py-2 text-yellow-200 focus:border-yellow-400 focus:outline-none" autocomplete="off" />
       <div id="communitySuggestions" class="absolute z-50 mt-1 w-full rounded-lg border border-yellow-500/30 bg-black/95 text-yellow-200 shadow-lg max-h-56 overflow-auto hidden"></div>
     </div>
     <button id="communityJoinBtn" type="button" class="w-full inline-flex items-center justify-center gap-2 rounded-full bg-yellow-500 px-4 py-2 text-sm font-semibold text-black hover:bg-yellow-400 transition">
       <i data-lucide="users"></i>
       <span>Request to Join</span>
     </button>
     <p id="communityStatus" class="text-xs text-yellow-400/80"></p>
   </section>
   <div id="loadingPosts" class="flex flex-col items-center justify-center py-6 text-yellow-400">
  <svg class="animate-spin h-6 w-6 text-yellow-400 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor"
      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z">
    </path>
  </svg>
  <span class="text-sm font-medium">Loading posts...</span>
</div>


  <!-- ðŸ”¸ Fixed Post Form -->
  <form id="activityPostForm" class="absolute bottom-12 left-0 right-0 flex items-center gap-3 px-4 py-3 bg-black/70 backdrop-blur-sm border-t border-yellow-500/20">
    <input id="postInput" type="text" placeholder="Write your post..." required class="flex-1 p-3 text-sm rounded-full bg-zinc-900 border border-yellow-500/30 text-yellow-300 placeholder-yellow-600 focus:outline-none" />
    <button type="submit" class="p-3 bg-yellow-500 rounded-full shadow-md hover:bg-yellow-600 active:scale-95 transition">
      <i data-lucide="send" class="w-5 h-5 text-black"></i>
    </button>
  </form>

  <!-- Refresh button removed for cleaner UI -->
</div>
